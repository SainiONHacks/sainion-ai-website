<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SainiON AI</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">ğŸ¯ SainiON AI</a>
            <div class="nav-links">
                <a href="index.html">Home</a>
            </div>
        </div>
    </nav>

    <div class="login-container">
        <div class="login-box">
            <h1>Login to Your Account</h1>
            <p class="subtitle">Enter your email and license key to generate desktop activation code</p>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>ğŸ“§ Email</label>
                    <input type="email" id="email" placeholder="your@email.com" required>
                </div>

                <div class="form-group">
                    <label>ğŸ”‘ License Key</label>
                    <input type="text" id="licenseKey" placeholder="XXXX-XXXX-XXXX-XXXX" required>
                    <small>Enter the license key you received via email</small>
                </div>

                <button type="submit" class="btn-primary" id="loginBtn">
                    ğŸš€ Generate Activation Code
                </button>
            </form>

            <div id="sessionTokenResult" style="display:none;">
                <div class="success-box">
                    <h2>âœ… Login Successful!</h2>
                    <p><strong>Copy this activation code and paste it in your desktop app:</strong></p>
                    <div class="token-display" id="tokenDisplay"></div>
                    <button onclick="copyToken()" class="btn-secondary">ğŸ“‹ Copy Code</button>
                    <p class="note">âš ï¸ This code expires in 24 hours</p>
                    <hr>
                    <h3>Next Steps:</h3>
                    <ol class="
steps">
                        <li>Copy the activation code above</li>
                        <li>Open SainiON AI desktop app</li>
                        <li>Click "ğŸ‘¤ My Account" â†’ "ğŸŒ Login via Website"</li>
                        <li>Paste the code when prompted</li>
                        <li>All features will be unlocked! ğŸ‰</li>
                    </ol>
                </div>
            </div>

            <div class="divider">OR</div>

            <div class="alternate-method">
                <p>ğŸ’¡ You can also activate directly in the desktop app:</p>
                <ul>
                    <li>Open SainiON AI</li>
                    <li>Click "ğŸ”‘ Enter License Key"</li>
                    <li>Paste your license key</li>
                    <li>No need for activation code!</li>
                </ul>
            </div>

            <div class="help-section">
                <p>Don't have a license? <a href="index.html#pricing">Buy one here</a></p>
                <p>Lost your license key? Contact support</p>
            </div>
        </div>
    </div>

    <script>
        async function handleLogin(event) {
            event.preventDefault();

            const email = document.getElementById('email').value.trim().toLowerCase();
            const licenseKey = document.getElementById('licenseKey').value.trim();
            const loginBtn = document.getElementById('loginBtn');

            // Disable button
            loginBtn.disabled = true;
            loginBtn.innerHTML = 'â³ Generating code...';

            try {
                // First validate license
                const validateResponse = await fetch('https://Nitinsaini077.pythonanywhere.com/webhook/validate-license', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ license_key: licenseKey })
                });

                const validateData = await validateResponse.json();

                if (!validateData.valid) {
                    alert('âŒ ' + validateData.message);
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'ğŸš€ Generate Activation Code';
                    return;
                }

                // Check if email matches
                if (validateData.email !== email) {
                    alert('âŒ Email does not match license key');
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'ğŸš€ Generate Activation Code';
                    return;
                }

                // Generate session token
                const sessionResponse = await fetch('https://Nitinsaini077.pythonanywhere.com/webhook/generate-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: email,
                        license_key: licenseKey
                    })
                });

                const sessionData = await sessionResponse.json();

                if (sessionData.success) {
                    // Show session token
                    document.getElementById('loginForm').style.display = 'none';
                    document.getElementById('sessionTokenResult').style.display = 'block';
                    document.getElementById('tokenDisplay').textContent = sessionData.session_token;
                } else {
                    alert('âŒ Failed to generate activation code');
                    loginBtn.disabled = false;
                    loginBtn.innerHTML = 'ğŸš€ Generate Activation Code';
                }

            } catch (error) {
                console.error('Login error:', error);
                alert('âŒ Connection error. Please check your internet and try again.');
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'ğŸš€ Generate Activation Code';
            }
        }

        function copyToken() {
            const token = document.getElementById('tokenDisplay').textContent;
            navigator.clipboard.writeText(token).then(() => {
                alert('âœ… Activation code copied to clipboard!\n\nNow paste it in your desktop app.');
            }).catch(err => {
                console.error('Copy failed:', err);
                alert('Please manually select and copy the code');
            });
        }
    </script>
</body>

</html>